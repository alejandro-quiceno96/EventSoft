{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Usuarios</title>
    <link rel="stylesheet" href="{% static 'app_super_admin/css/gestionar_usuario.css' %}">
    <script src="https://kit.fontawesome.com/your-fontawesome-kit.js" crossorigin="anonymous"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<section class="header-admin">
  <!-- Sidebar -->
  <div id="sidebar-admin-custom" class="sidebar-custom collapsed">
    <div class="sidebar-header d-flex justify-content-between align-items-center">
      <h4>Super Admin</h4>
      <button class="btn btn-sm text-danger close-sidebar"><i class="fas fa-times"></i></button>
    </div>
    <ul class="sidebar-list">
      <li><a href="{% url 'super_admin:index_super_admin' %}"><i class="fas fa-home me-2"></i>Inicio</a></li>
      <li><a href="{% url 'super_admin:usuarios' %}"><i class="fas fa-user-plus me-2"></i>Asignar nuevo administrador</a></li>
     <li><a href="{% url 'inicio_visitante' %}"><i class="fa-solid fa-user"></i> Volver al Visitante</a></li>
    </ul>
  </div>

  <div class="contenedor-1">
    <button class="btn text-white ms-2" id="toggleSidebarBtn">
      <i class="fas fa-bars fa-lg"></i>
    </button>
    <img class="logo-sena" src="{% static 'app_administrador/image/Logo Sena 1.png'%}" alt="Logo Sena">
    <a href="">EventSoft</a>
  </div>

  <div class="contenedor-2">
    <button id="btnUsuarios" class="boton-seccion active">Usuarios</button>
    <button id="btnAdmins" class="boton-seccion">Administradores de Eventos</button>
  </div>
</section>

<main class="p-4">

  <!-- Sección Usuarios -->
  <section id="usuariosSection" class="seccion-tabla">
    <h2>Lista de Usuarios</h2>
    <div class="mb-3">
  <input type="text" id="buscadorCedula" class="form-control" placeholder="Buscar por cédula..." onkeyup="filtrarPorCedula(this.value)">
</div>

    <div class="table-responsive">
      <table class="tabla-usuarios">
        <thead>
          <tr>
            <th>Cédula</th>
            <th>Nombre</th>
            <th>Apellido</th>
            <th>Tipo Documento</th>
            <th>Teléfono</th>
            <th>Correo</th>
            <th>Acción</th>
          </tr>
        </thead>
        <tbody>
          {% for usuario in usuarios_no_admin %}
          <tr>
            <td>{{ usuario.documento_identidad }}</td>
            <td>{{ usuario.first_name }}</td>
            <td>{{ usuario.last_name }}</td>
            <td>{{ usuario.tipo_documento }}</td>
            <td>{{ usuario.telefono }}</td>
            <td>{{ usuario.email }}</td>
            <td>
              <a href="#" class="btn-asignar" data-id="{{ usuario.id }}" data-nombre="{{ usuario.first_name }} {{ usuario.last_name }}" onclick="abrirModalAsignacion(this)">
                <i class="fas fa-user-shield"></i> Asignar como administrador
              </a>
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="7" class="text-center">No hay usuarios disponibles.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <!-- Sección Administradores -->
  <section id="adminsSection" class="seccion-tabla d-none">
    <h2>Lista de Administradores de Eventos</h2>
    <div class="mb-3">
  <input type="text" id="buscadorCedula" class="form-control" placeholder="Buscar por cédula..." onkeyup="filtrarPorCedula(this.value)">
</div>

    <div class="table-responsive">
      <table class="tabla-usuarios">
        <thead>
  <tr>
    <th>Cédula</th>
    <th>Nombre</th>
    <th>Apellido</th>
    <th>Teléfono</th>
    <th>Correo</th>
    <th>Eventos Creados</th>
    <th>Cupo disponible</th>
    <th>Tiempo limite</th>
    <th>Acciones</th> <!-- Nueva columna -->
  </tr>
</thead>
<tbody>
  {% for admin in administradores %}
  <tr>
    <td>{{ admin.usuario.documento_identidad }}</td>
    <td>{{ admin.usuario.first_name }}</td>
    <td>{{ admin.usuario.last_name }}</td>
    <td>{{ admin.usuario.telefono }}</td>
    <td>{{ admin.usuario.email }}</td>
    <td>{{ admin.eventos_creados }}</td>
    <td>{{ admin.cupo_disponible }}</td>
    <td>{{ admin.tiempo_limite|date:"Y-m-d" }}</td>
    <td>
      <button class="btn-cancelar-admin"
              data-id="{{ admin.id }}"
              id="admin-id-cancelar"
              onclick="abrirModalCancelarAdmin(this)">
        Cancelar administrador
      </button>
    </td>
  </tr>
  {% empty %}
  <tr><td colspan="7" class="text-center">No hay administradores registrados.</td></tr>
  {% endfor %}
</tbody>

      </table>
    </div>
  </section>
</main>


<!-- Modal de confirmación con formulario -->
<div id="modalConfirmar" class="modal-confirmar d-none">
  <div class="modal-contenido">
    <h4>Asignar a <span id="nombreUsuarioModal"></span> como administrador</h4>

   <form id="formAsignacion" method="POST" action="{% url 'super_admin:asignar_admin_evento' %}">
  {% csrf_token %}
  <input type="hidden" id="usuarioId" name="usuario_id"> <!-- campo oculto para enviar el id -->

  <div class="mb-2">
    <label for="eventosPermitidos">Cantidad máxima de eventos:</label>
    <input type="number" id="eventosPermitidos" name="eventos" min="1" required>
  </div>
  <div class="mb-2">
    <label for="fechaLimiteRol">Fecha límite del rol:</label>
    <input type="date" id="fechaLimiteRol" name="fecha_limite" readonly>
  </div>
  <div class="mb-2">
    <label for="codigoAcceso">Código de acceso:</label>
    <input type="text" id="codigoAcceso" name="codigo" readonly>
  </div>

  <div class="acciones-modal mt-3">
    <button type="button" class="btn-cancelar" onclick="cerrarModal()">Cancelar</button>
    <button type="submit" class="btn-confirmar">Asignar</button>
  </div>
</form>

  </div>
</div>

<!-- Loader -->
<div id="loader-bg" class="d-none loader-overlay">
  <div class="loader-spinner"></div>
  <p class="text-white mt-2">Procesando solicitud...</p>
</div>

<!-- Modal Éxito -->
<div class="modal fade" id="modalExito" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center p-4">
      <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
      <p class="fw-bold">¡Rol asignado exitosamente!</p>
    </div>
  </div>
</div>
<!-- Modal Confirmación -->
<div class="modal fade" id="modalConfirmacionFinal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center p-4">
      <p class="fw-bold">¿Estás seguro de asignar este rol?</p>
      <div class="d-flex justify-content-center mt-3">
        <button class="btn btn-secondary me-3" data-bs-dismiss="modal">Cancelar</button>
        <button id="btnConfirmarAsignacionFinal" class="btn text-white" style="background-color:#007832;">Confirmar</button>
      </div>
    </div>
  </div>
</div>


<!-- Modal de Éxito -->
<div id="modalExito" class="modal fade" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center p-4">
      <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
      <p class="fw-bold mensaje-exito">¡Acción realizada con éxito!</p>
    </div>
  </div>
</div>

<div class="modal fade" id="modalCancelarAdmin" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center p-4">
      <form id="formCancelarAdmin" method="POST">
        {% csrf_token %}
        <input type="hidden" id="admin-id-cancelar" name="admin_id">
        <p class="fw-bold">¿Estás seguro de cancelar este administrador?</p>
        <div class="d-flex justify-content-center mt-3">
          <button type="button" class="btn btn-secondary me-3" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-danger">Confirmar</button>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- Modal de Error -->
<div class="modal fade" id="modalError" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center p-4">
      <i class="fas fa-times-circle fa-3x text-danger mb-3"></i>
      <p class="fw-bold" id="mensaje-error-modal">Ha ocurrido un error inesperado.</p>
      <div class="d-flex justify-content-center mt-3">
        <button type="button" class="btn btn-outline-danger px-4" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>




<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script src="{% static 'app_super_admin/js/gestionar_usuarios.js' %}"></script>
<script>
  const UrlcancelarAdmin = "{% url 'super_admin:cancelar_administrador' %}";
</script>
<script>
document.addEventListener('DOMContentLoaded', function () {
  const toggleBtn = document.getElementById('toggleSidebarBtn');
  const sidebar = document.getElementById('sidebar-admin-custom');
  const closeBtn = sidebar.querySelector('.close-sidebar');

  toggleBtn.addEventListener('click', () => {
    sidebar.classList.add('active');
  });

  closeBtn.addEventListener('click', () => {
    sidebar.classList.remove('active');
  });

  // Cerrar sidebar al hacer clic fuera (opcional)
  document.addEventListener('click', (e) => {
    if (!sidebar.contains(e.target) && !toggleBtn.contains(e.target)) {
      sidebar.classList.remove('active');
    }
  });
});
</script>



</body>
</html>
