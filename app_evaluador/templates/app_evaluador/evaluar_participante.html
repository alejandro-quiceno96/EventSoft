{% extends "app_evaluador/base.html" %}

{% block title %}Evaluar{% endblock %}

{% block extra_styles %}
<style>
    body {
        background-color: #f4f6f9;
    }
    .container {
        max-width: 900px;
        margin-top: 50px;
    }
    .btn {
        padding: 10px 20px;
        font-size: 16px;
    }
    h2, h4 {
        color: #333;
    }
    .alert-info {
        background-color: #cce5ff;
        color: #004085;
        padding: 10px;
        margin-top: 20px;
        border-radius: 5px;
    }
    .alert-danger {
        padding: 10px;
        margin-top: 15px;
        border-radius: 5px;
    }
</style>

<div class="container">
    <h2 class="text-center mb-4">Evaluar Participante</h2>
    <h5 class="text-center mb-4">{{ participante.nombre }} - {{ evento.nombre }}</h5>

    <div class="alert alert-info">
        <strong>Importante:</strong> Cada puntaje debe estar entre 0 y 100.
    </div>

    <form id="form-evaluacion" method="POST" action="{% url 'evaluador:asignar_puntaje' evento_id=evento.id participante_id=participante.id evaluador_id=evaluador %}">
        {% csrf_token %}
        <div class="mt-4">
            <h4>Criterios de Evaluación</h4>
            <table class="table table-bordered table-striped">
                <thead class="table-primary">
                    <tr>
                        <th>Criterio</th>
                        <th>Puntaje</th>
                    </tr>
                </thead>
                <tbody>
                    {% for criterio in evento.criterios %}
                    <tr>
                        <td>{{ criterio.descripcion }} ({{ criterio.peso }}%)</td>
                        <td>
                            <input type="number" name="puntajes" class="form-control puntaje-input" min="0" max="100" required />
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div id="error-message" class="alert alert-danger" style="display:none;">
            Cada puntaje debe estar entre 0 y 100. Corrige los valores antes de guardar.
        </div>

        <div class="mt-4 d-flex justify-content-between m-2">
            <button type="submit" class="btn btn-success">Guardar Calificación</button>
            <a href="{% url 'evaluador:ver_participantes' evento_id=evento.id %}" class="btn btn-danger">Cancelar</a>
        </div>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script>
    // Validar que cada input esté entre 0 y 100
    document.getElementById('form-evaluacion').addEventListener('submit', function(e) {
        let valid = true;
        document.querySelectorAll('.puntaje-input').forEach(input => {
            const value = parseFloat(input.value);
            if (isNaN(value) || value < 0 || value > 100) {
                valid = false;
            }
        });

        if (!valid) {
            e.preventDefault(); // Detiene el envío
            document.getElementById('error-message').style.display = 'block'; // Muestra error
        } else {
            document.getElementById('error-message').style.display = 'none'; // Oculta error
        }
    });
</script>
{% endblock %}
