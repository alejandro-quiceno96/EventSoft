{% extends "app_administrador/baseadmin.html" %}
{% load static %}

{% block title %}
    {{ administrador|default:'Administrador' }}
{% endblock %}

{% block content %}
 <link rel="stylesheet" href="{% static 'app_administrador/css/crearEvento.css'%}">
<div class="contenedor-principal-crear">
    <div class="contenedor-crear-evento">
        <h2>Nuevo Evento</h2>
        
        <!-- Indicador de progreso -->
        <div class="progreso-container">
            <div class="progreso-barra">
                <div class="progreso-fill" id="progreso-fill"></div>
            </div>
            <div class="progreso-pasos">
                <span class="paso active" id="paso-1">1</span>
                <span class="paso" id="paso-2">2</span>
            </div>
        </div>

        <form action="" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            
            <input type="hidden" name="estado_evento" value="{{evento.eve_estado}}">
            <!-- P√ÅGINA 1: INFORMACI√ìN B√ÅSICA DEL EVENTO -->
            <div id="pagina1" class="pagina pagina-activa">
                <div class="seccion-titulo">
                    <h3>üìã Informaci√≥n B√°sica del Evento</h3>
                </div>

                <!-- Nombre del Evento -->
                <div class="div contenedor-input-1">
                    <label for="nombre_evento">Nombre del Evento:</label>
                    <input type="text" name="nombre_evento" id="nombre_evento" value="{{evento.eve_nombre}}" maxlength="100" oninput="actualizarContaNombre()" required>
                    <small id="contador_nombre" class="contador">0 / 100</small>
                </div>

                <!-- Descripci√≥n -->
                <div class="div contenedor-input-2">
                    <label for="descripcion_evento">Descripci√≥n:</label>
                    <textarea id="descripcion_evento" name="descripcion_evento" placeholder="Describe tu evento..." maxlength="400" oninput="actualizarContador()" rows="4" required></textarea>
                    <small id="contador" class="contador">0 / 400</small>
                </div>

                <!-- Ubicaci√≥n -->
                <div class="div contenedor-input-3">
                    <div class="fila-inputs">
                        <div class="div-1">
                            <label for="ciudad">Ciudad:</label>
                            <input type="text" name="ciudad" id="ciudad" value="{{evento.eve_ciudad}}" required>
                        </div>
                        <div class="div-2">
                            <label for="lugar">Lugar:</label>
                            <input type="text" name="lugar" id="lugar" value="{{evento.eve_lugar}}" required>
                        </div>
                    </div>
                </div>

                <div class="div contenedor-input-4">
                    <div class="fila-inputs">
                        <div class="div-3">
                        <label for="fecha_inicio">Fecha de inicio:</label>
                        <input type="date" 
                                value="{{ evento.eve_fecha_inicio|date:'Y-m-d' }}" 
                                name="fecha_inicio" id="fecha_inicio" required>
                        </div>
                        <div class="div-4">
                        <label for="fecha_fin">Fecha de fin:</label>
                        <input type="date" 
                                value="{{ evento.eve_fecha_fin|date:'Y-m-d' }}" 
                                name="fecha_fin" id="fecha_fin" required>
                        </div>
                    </div>
                </div>

                <!-- Bot√≥n Continuar -->
                <div class="div contenedor-input-5">
                    <div class="botones-navegacion">
                        <button type="button" class="boton-continuar" onclick="siguiente(2)">
                            Continuar
                            <img src="{% static 'app_administrador/image/flecha-derecha.png' %}" alt="Siguiente">
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- P√ÅGINA 2: CATEGORIZACI√ìN Y ARCHIVOS -->
            <div id="pagina2" class="pagina pagina-inactiva">
                <div class="seccion-titulo">
                    <h3>üè∑Ô∏è Categorizaci√≥n y Configuraci√≥n</h3>
                </div>

                <!-- √Årea y Categor√≠a -->
                <div class="div contenedor-input-6">
                    <div class="fila-inputs">
                        <div>
                            <label for="area">√Årea:</label>
                            <select id="area" name="area" required>
                                <option value="area_seleccionada.id">{{area_seleccionada}}</option>

                                {% for area in areas %}
                                    <option value="{{ area.id }}">{{ area.are_nombre }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label for="categoria">Categor√≠a:</label>
                            <select id="categoria" name="categoria" required>
                                {% if categoria_seleccionada %}
                                    <option value="{{ categoria_seleccionada.id }}">{{ categoria_seleccionada }}</option>
                                {% endif %}
                                <option value="">Seleccione una categor√≠a</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Configuraci√≥n de Cupo -->
                <!-- Configuraci√≥n de Cupo -->
<div class="div contenedor-input-11">
    <div class="fila-inputs">
        <div>
            <label for="permitir_participantes">¬øTiene Cupo L√≠mite?</label>
            <select 
                id="permitir_participantes_mod" 
                name="permitir_participantes" 
                onchange="toggleCantidadParticipantesModificar()"
            >
                {% if evento.eve_capacidad > 0 %}
                    <option value="si" selected>S√≠</option>
                    <option value="no">No</option>
                {% else %}
                    <option value="no" selected>No</option>
                    <option value="si">S√≠</option>
                {% endif %}
            </select>
        </div>
            </select>
        </div>

        <div id="cantidad_participantes_div_mod" 
             style="display: {% if evento.eve_capacidad > 0 %}block{% else %}none{% endif %};">
            <label for="cantidad_personas">Aforo M√°ximo:</label>
            <input 
                type="number" 
                min="1" 
                value="{{ evento.eve_capacidad|default_if_none:'' }}" 
                name="cantidad_personas" 
                id="cantidad_personas_mod"
            >
        </div>
    </div>
    <!-- Costo de Inscripci√≥n -->
                <div class="div contenedor-input-7">
                    <div>
                        <label for="inscripcion">Costo de inscripci√≥n:</label>
                        <select name="inscripcion" id="inscripcion" required>
                            {% if evento.eve_tienecosto == 1 %}
                                <option value="Si" selected>S√≠</option>
                                <option value="No">No</option>
                            {% else %}
                                <option value="No" selected>No</option>
                                <option value="Si">S√≠</option>
                            {% endif %}
                        </select>
                    </div>
                </div>


                <div class="seccion-titulo">
                    <h3>üìÅ Archivos de Informaci√≥n</h3>
                </div>

                <!-- Archivos del Evento -->
                <div class="archivo-item">
    <label for="imagen_evento">Imagen del Evento:</label>
    <div class="file-upload-area" id="imagen-upload-area">
        <input type="file" name="imagen_evento" id="imagen_evento" accept="image/*">
        <div class="upload-placeholder" style="{% if evento.eve_imagen %}display:none;{% endif %}">
            <span>Haz clic o arrastra una imagen aqu√≠</span>
        </div>
        <img id="previewImagen" 
             class="preview-imagen"
             {% if evento.eve_imagen %}
                 src="{{ evento.eve_imagen.url }}"
                 style="display:block;"
             {% else %}
                 style="display:none;"
             {% endif %}
             alt="Vista previa">
    </div>
</div>

<div class="archivo-item">
    <label for="documento_evento">Programaci√≥n del Evento (PDF):</label>
    {% if evento.eve_programacion %}
       <a class="btn-ver-doc " href="{{evento.eve_programacion.url}}" target="_blank" download="{{evento.eve_programacion.name}}">Ver PDF</a>
    {% else %}
       <span class="no-doc">No hay documento cargado</span>
    {% endif %}
    
    <div class="file-upload-area" id="documento-upload-area">
        <input type="file" name="documento_evento" id="documento_evento" accept=".pdf">
        <div class="upload-placeholder" style="{% if evento.eve_programacion %}display:none;{% endif %}">
            <span>Haz clic o arrastra un PDF aqu√≠</span>
        </div>
        <iframe id="previewDocumento" class="preview-documento"
            {% if evento.eve_programacion %}
                src="{{ evento.eve_programacion.url }}"
                style="display:block;"
            {% else %}
                style="display:none;"
            {% endif %}></iframe>
    </div>
</div>
<!-- Botones de Navegaci√≥n -->
                <div class="div contenedor-input-9">
                    <div class="botones-navegacion">
                        <button type="button" class="boton-volver" onclick="volver(1)">
                            <img src="{% static 'app_administrador/image/atras.png' %}" alt="Volver">
                            Volver
                        </button>
                        <button type="submit" class="boton-crear">
                            Modificar Evento
                            <img src="{% static 'app_administrador/image/crear-img.png' %}" alt="Crear">
                        </button>
                    </div>
                </div>
</div>

                


                
            </div>
        </form>
    </div>
</div>



<script>
    document.getElementById("descripcion_evento").value = "{{evento.eve_descripcion|default_if_none:''}}";
    const baseCategoriaUrl = "{% url 'administrador:get_categorias' 0 %}".replace('0', '');
</script>
<script src="{% static 'app_administrador/js/modificarEventos.js' %}"></script>
<script src="{% static 'app_administrador/js/crearEvento.js' %}"></script>
<script src="{% static 'app_administrador/js/previaImagen.js' %}"></script>

{% endblock %}