{% extends "app_administrador/baseadmin.html" %}
{% load static %}

{% block title %}
    {{ administrador|default:'Administrador' }}
{% endblock %}

{% block content %}
 <link rel="stylesheet" href="{% static 'app_administrador/css/crearEvento.css'%}">
<div class="contenedor-principal-crear">
    <div>
        <a href="{% url 'administrador:index_administrador' %}" class="btn-volver-admin">
            <img src="{% static 'app_administrador/image/atras.png' %}" alt="Volver">
            Volver a Administraci√≥n
        </a>
    </div>
    <div class="contenedor-crear-evento">
        <h2>Nuevo Evento</h2>
        
        <!-- Indicador de progreso -->
        <div class="progreso-container">
            <div class="progreso-barra">
                <div class="progreso-fill" id="progreso-fill"></div>
            </div>
            <div class="progreso-pasos">
                <span class="paso active" id="paso-1">1</span>
                <span class="paso" id="paso-2">2</span>
            </div>
        </div>

        <form action="{% url 'administrador:crear_evento' %}" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            
            <!-- P√ÅGINA 1: INFORMACI√ìN B√ÅSICA DEL EVENTO -->
            <div id="pagina1" class="pagina pagina-activa">
                <div class="seccion-titulo">
                    <h3>üìã Informaci√≥n B√°sica del Evento</h3>
                </div>

                <!-- Nombre del Evento -->
                <div class="div contenedor-input-1">
                    <label for="nombre_evento">Nombre del Evento<strong class="obligacion-input">*</strong>:</label>
                    <input type="text" name="nombre_evento" id="nombre_evento" maxlength="100" oninput="actualizarContaNombre()" required>
                    <small id="contador_nombre" class="contador">0 / 100</small>
                </div>

                <!-- Descripci√≥n -->
                <div class="div contenedor-input-2">
                    <label for="descripcion_evento">Descripci√≥n<strong class="obligacion-input">*</strong>:</label>
                    <textarea id="descripcion_evento" name="descripcion_evento" placeholder="Describe tu evento..." maxlength="400" oninput="actualizarContador()" rows="4" required></textarea>
                    <small id="contador" class="contador">0 / 400</small>
                </div>

                <!-- Ubicaci√≥n -->
                <div class="div contenedor-input-3">
                    <div class="fila-inputs">
                        <div class="div-1">
                            <label for="ciudad">Ciudad<strong class="obligacion-input">*</strong>:</label>
                            <input type="text" name="ciudad" id="ciudad" required>
                        </div>
                        <div class="div-2">
                            <label for="lugar">Lugar<strong class="obligacion-input">*</strong>:</label>
                            <input type="text" name="lugar" id="lugar" required>
                        </div>
                    </div>
                </div>

                <!-- Fechas -->
                <div class="div contenedor-input-4">
                    <div class="fila-inputs">
                        <div class="div-3">
                            <label for="fecha_inicio">Fecha de inicio<strong class="obligacion-input">*</strong>:</label>
                            <input type="date" name="fecha_inicio" id="fecha_inicio" required>
                        </div>
                        <div class="div-4">
                            <label for="fecha_fin">Fecha de fin<strong class="obligacion-input">*</strong>:</label>
                            <input type="date" name="fecha_fin" id="fecha_fin" required>
                        </div>
                    </div>
                </div>

                <!-- Bot√≥n Continuar -->
                <div class="div contenedor-input-5">
                    <div class="botones-navegacion">
                        <button type="button" class="boton-continuar" onclick="siguiente(2)">
                            Continuar
                            <img src="{% static 'app_administrador/image/flecha-derecha.png' %}" alt="Siguiente">
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- P√ÅGINA 2: CATEGORIZACI√ìN Y ARCHIVOS -->
            <div id="pagina2" class="pagina pagina-inactiva">
                <div class="seccion-titulo">
                    <h3>üè∑Ô∏è Categorizaci√≥n y Configuraci√≥n</h3>
                </div>

                <!-- √Årea y Categor√≠a -->
                <div class="div contenedor-input-6">
                    <div class="fila-inputs">
                        <div>
                            <label for="area">√Årea<strong class="obligacion-input">*</strong>:</label>
                            <select id="area" name="area" required>
                                <option value="">Seleccione un √°rea</option>
                                {% for area in areas %}
                                    <option value="{{ area.id }}">{{ area.are_nombre }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div>
                            <label for="categoria">Categor√≠a<strong class="obligacion-input">*</strong>:</label>
                            <select id="categoria" name="categoria" required>
                                <option value="">Seleccione una categor√≠a</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Configuraci√≥n de Cupo -->
                <div class="div contenedor-input-11">
                    <div class="fila-inputs">
                        <div>
                            <label for="permitir_participantes">¬øTiene Cupo L√≠mite?<strong class="obligacion-input">*</strong></label>
                            <select id="permitir_participantes" name="permitir_participantes" onchange="toggleCantidadParticipantes()">
                                <option value="0">No</option>
                                <option value="1">S√≠</option>
                            </select>
                        </div>
                        <div id="cantidad_participantes_div" style="display: none;">
                            <label for="cantidad_personas">Aforo M√°ximo:</label>
                            <input type="number" min="1" value="1" name="cantidad_personas" id="cantidad_personas">
                        </div>
                    </div>
                </div>

                <!-- Costo de Inscripci√≥n -->
                <div class="div contenedor-input-7">
                    <div>
                        <label for="inscripcion">Costo de inscripci√≥n:</label>
                        <select name="inscripcion" id="inscripcion" required>
                            <option value="">Seleccionar una opci√≥n<strong class="obligacion-input">*</strong></option>
                            <option value="Si">S√≠</option>
                            <option value="No">No</option>
                        </select>
                    </div>
                </div>

                <div class="seccion-titulo">
                    <h3>üìÅ Archivos de Informaci√≥n</h3>
                </div>

                <!-- Archivos del Evento -->
                <div class="div contenedor-input-10">
                    <div class="archivo-container">
                        <div class="archivo-item">
                            <label for="imagen_evento">Imagen del Evento<strong class="obligacion-input">*</strong>:</label>
                            <div class="file-upload-area" id="imagen-upload-area">
                                <input type="file" name="imagen_evento" id="imagen_evento" accept="image/*" required>
                                <div class="upload-placeholder">
                                    <img src="{% static 'app_administrador/image/upload-icon.png' %}" alt="Upload" class="upload-icon">
                                    <span>Haz clic o arrastra una imagen aqu√≠</span>
                                </div>
                                <img id="previewImagen" class="preview-imagen" style="display: none;" alt="Vista previa">
                            </div>
                        </div>
                        
                        <div class="archivo-item">
                            <label for="documento_evento">Programaci√≥n del Evento (PDF):</label>
                           <p class="mensaje-info">
                            No es obligatoria subir la programaci√≥n del evento para su creaci√≥n,
                            la puedes subir cuando la tengas lista.
                            </p>

                            <div class="file-upload-area" id="documento-upload-area">
                                <input type="file" name="documento_evento" id="documento_evento" accept=".pdf">
                                <div class="upload-placeholder">
                                    <img src="{% static 'app_administrador/image/pdf-icon.png' %}" alt="PDF" class="upload-icon">
                                    <span>Haz clic o arrastra un PDF aqu√≠</span>
                                </div>
                                <iframe id="previewDocumento" class="preview-documento" style="display: none;"></iframe>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botones de Navegaci√≥n -->
                <div class="div contenedor-input-9">
                    <div class="botones-navegacion">
                        <button type="button" class="boton-volver" onclick="volver(1)">
                            <img src="{% static 'app_administrador/image/atras.png' %}" alt="Volver">
                            Volver
                        </button>
                        <button type="submit" class="boton-crear">
                            Crear Evento
                            <img src="{% static 'app_administrador/image/crear-img.png' %}" alt="Crear">
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Modal personalizado para revisi√≥n de evento -->
<div id="modalRevisionEvento" class="modal-revision">
  <div class="modal-revision-contenido">
    <div class="icono-exito">
      <i class="fa-solid fa-circle-check"></i>
    </div>
    <h2>¬°Evento Creado Exitosamente!</h2>
    <p>
      Tu evento est√° en revisi√≥n por el superadministrador.<br>
      Cuando sea aceptado, se ver√° reflejado en la p√°gina principal del evento.
    </p>
    <button onclick="cerrarModalRevisionEvento()">Aceptar</button>
  </div>
</div>



{% if mostrar_modal_revision %}
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      mostrarModalRevisionEvento();
    });
  </script>
{% endif %}
<!-- Scripts -->
 <script>
  document.addEventListener("DOMContentLoaded", function () {
    const params = new URLSearchParams(window.location.search);
    if (params.get("revision") === "evento") {
      document.getElementById("modalRevisionEvento").style.display = "block";
    }
  });

  function cerrarModalRevisionEvento() {
    document.getElementById("modalRevisionEvento").style.display = "none";
    // Quita el par√°metro "revision" de la URL
    const url = new URL(window.location);
    url.searchParams.delete("revision");
    window.history.replaceState({}, document.title, url);
  }
</script>
<script>
    const baseCategoriaUrl = "{% url 'administrador:get_categorias' 0 %}".replace('0', '');
</script>
<script src="{% static 'app_administrador/js/crearEvento.js' %}"></script>
<script src="{% static 'app_administrador/js/previaImagen.js' %}"></script>
{% endblock %}