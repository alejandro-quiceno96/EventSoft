{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Configurar Certificado</title>
  <link rel="stylesheet" href="{% static 'app_administrador/css/config_certificado.css' %}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

<div class="contenedor-configuracion">
  <div class="grupo centrado mb-3">
        <a href="{% url 'administrador:index_administrador' %}" class="boton-animado">
            <i class="fa-solid fa-house"></i> Volver al Inicio
        </a>
    </div>

  <h2>Configuración del Certificado</h2>
  <p>Configure los detalles del certificado que se generará para los participantes del evento.</p>

  <form id="formulario-certificado" class="formulario-configuracion" action="{% url 'administrador:configuracion_certificados' evento.id %}" method="post" enctype="multipart/form-data">
  {% csrf_token %}

  <div class="form-group">
    <label for="id_nombre_certificador">Nombre de quien genera el certificado:</label>
    <input type="text"
           id="id_nombre_certificador"
           name="nombre_certificador"
           placeholder="Ej. EventSoft"
           value="{{ certificado.certifica|default:''}}"
           required>
  </div>

  <div class="form-group">
    <label for="con_diseno">¿Desea usar diseño de fondo hecho por ti?</label>
    <select id="con_diseno" name="con_diseno">
      <option value="no" >No</option>
      <option value="si">Sí</option>
    </select>
  </div>

  {%if certificado.diseño %}
  <div class="form-group">
    <label for="id_diseno_actual">Diseño actual:</label>
    <img src="{{ certificado.diseño.url }}" alt="Diseño Actual" class="img-thumbnail" style="max-width: 200px;">
  </div>
  {%endif%}

  <div id="grupo-diseno" style="display: none;" class="form-group">
    <label for="id_diseno">Subir diseño (imagen de fondo):</label>
    <input type="file" id="id_diseno" name="diseno" accept="image/*">

  </div>

  <div class="form-group">
    <label for="con_firma">¿Desea incluir firma?</label>
    <select id="con_firma" name="con_firma">
      <option value="no" >No</option>
      <option value="si" >Sí</option>
    </select>
  </div>

  <div id="grupo-firma" style="display: none;">
    <div class="form-group">
      <label for="id_firma">Imagen de la firma:</label>
      <input type="file" id="id_firma" name="firma" accept="image/*">
    </div>
    {% if certificado.firma %}
    <div class="form-group">
      <label for="id_firma_actual">Firma actual:</label>
      <img src="{{ certificado.firma.url }}" alt="Firma Actual" class="img-thumbnail" style="max-width: 200px;">
    </div>
    {%endif%}
    <div class="form-group">
      <label for="id_firma_nombre">Nombre del firmante:</label>
      <input type="text" id="id_firma_nombre" name="firma_nombre" placeholder="Ej. EventSoft" value="{{ certificado.firma_nombre|default:'' }}">
    </div>
    <div class="form-group">
      <label for="id_firma_cargo">Cargo del firmante:</label>
      <input type="text" id="id_firma_cargo" name="firma_cargo" placeholder="Ej. Gerente General" value="{{ certificado.firma_cargo|default:'' }}">
    </div>
  </div>

  <div class="form-group">
    <label for="tipografia">Tipografía del texto:</label>
    <select id="tipografia" name="tipografia">
      <option value="'Work Sans', sans-serif" >Work Sans</option>
      <option value="Arial, sans-serif">Arial</option>
      <option value="'Times New Roman', serif">Times New Roman</option>
      <option value="Georgia, serif">Georgia</option>
      <option value="'Courier New', monospace">Courier New</option>
    </select>
  </div>

  <div class="form-group">
    <label for="orientacion">Orientación:</label>
    <select id="orientacion" name="orientacion">
      <option value="vertical">Vertical</option>
      <option value="horizontal">Horizontal</option>
    </select>
  </div>

  <div class="form-group">
    <label for="lugar_expedicion">Lugar de expedición:</label>
    <input type="text" id="lugar_expedicion" name="lugar_expedicion" placeholder="Ej. Manizales" value="{{certificado.lugar_expedicion|default:'' }}" required>
  </div>

  <div class="form-group text-center">
    <button type="button" id="btn-previsualizar">Previsualizar Certificado</button>
  </div>

  <div class="form-group text-center">
    <button type="submit" id="btn-guardar">Guardar configuración</button>
  </div>

  <input type="hidden" id="diseñoModificar" value="{{ certificado.diseño.url|default:'' }}">
  {% if certificado.firma %}
    <input type="hidden" id="firmaModificar" value="{{ certificado.firma.url }}">
  {% else %}
    <input type="hidden" id="firmaModificar" value="">
  {% endif %}
</form>




<!-- Modal de previsualización -->
<div class="modal" id="modal-preview" style="display: none;">
  <div class="modal-content-preview">
    <span class="cerrar-modal" onclick="document.getElementById('modal-preview').style.display='none'">&times;</span>
    <div class="modal-body d-flex justify-content-center">
      <div class="preview-certificado" id="preview-certificado">
        <div id="nombre_genera_certificado"></div>
        <div id="constar" class="constar">
            CERTIFICA:
        </div>
        <div id="preview-texto" class="preview-texto">
          Que <strong>nombre_de_la_persona</strong> identificado(a) con el número de documento
          <strong>1234567890</strong> participó como <strong>rol_de_la_persona</strong> en el marco del <strong>nombre_del_evento</strong> desarrollado el <strong>fecha_del_evento</strong>.
        </div>
        <div id="preview-lugar-fecha" class="preview-lugar-fecha"></div>
        <div class="preview-firma-container">
            <img id="preview-firma" class="preview-firma" src="">
            <div id="preview-nombre" class="preview-nombre"></div>
            <div id="preview-cargo" class="preview-cargo"></div>
        </div>
        
      </div>
    </div>
  </div>
</div>

<!-- Modal de éxito -->
<div class="modal-exitoso" id="modal-exito" style="display: none;">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center p-4" style="border-radius: 12px; background-color: #f9f9f9;">
      <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
      <p class="fw-bold">¡Configuración guardada con éxito!</p>
     <button type="button" id="cerrar-modal" class="boton-animado">Cerrar</button>
    </div>
  </div>
</div>


<script>
  window.addEventListener('DOMContentLoaded', function () {
  const params = new URLSearchParams(window.location.search);
  if (params.get('guardado') === '1') {

    // Quitar el parámetro primero
    const newURL = window.location.origin + window.location.pathname;
    window.history.replaceState({}, document.title, newURL);

    // Mostrar el modal
    const modal = document.getElementById("modal-exito");
    if (modal) {
      modal.style.display = "flex";
    }
  }
  
});
document.getElementById("cerrar-modal").addEventListener("click", function() {
    document.getElementById("modal-exito").style.display = "none";
});





  document.addEventListener('DOMContentLoaded', function() {
    const conDisenoSelect = document.getElementById('con_diseno');
    const grupoDiseno = document.getElementById('grupo-diseno');
    const conFirmaSelect = document.getElementById('con_firma');
    const grupoFirma = document.getElementById('grupo-firma');
    const conDiseno = "{{con_diseno }}"
    const conFirma = "{{con_firma}}"
    const tipografia = "{{ certificado.tipografia|default:''|escapejs }}";
    const tipografiaSelect = document.getElementById('tipografia');
    
    if (tipografia !== "") {
      tipografiaSelect.value = tipografia;
    }
    // Estado inicial
    if (conDiseno === "True") {
      grupoDiseno.style.display = 'block';
      conDisenoSelect.value = 'si';
    } else {
      grupoDiseno.style.display = 'none';
      conDisenoSelect.value = 'no';
    }

    if (conFirma === "True") {
      grupoFirma.style.display = 'block';
      conFirmaSelect.value = 'si';
    } else {
      grupoFirma.style.display = 'none';
      conFirmaSelect.value = 'no';
    }


    if ("{{ certificado.orientacion }}") {
      document.getElementById('orientacion').value = "{{ certificado.orientacion }}";
    } else {
      document.getElementById('orientacion').value = 'vertical';
    }

  });
</script>






<script src="{% static 'app_administrador/js/config_certificados.js' %}"></script>
</body>
</html>
